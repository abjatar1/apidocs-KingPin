<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>KingPin API – Full Route Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #020617;
        --bg-alt: #020617;
        --bg-card: #020617;
        --border-subtle: rgba(148, 163, 184, 0.18);
        --accent: #0ea5e9;
        --accent-soft: rgba(56, 189, 248, 0.15);
        --accent-2: #e11d48;
        --accent-ok: #22c55e;
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --text-soft: #6b7280;
        --code-bg: #020617;
        --badge-get: #22c55e;
        --badge-post: #0ea5e9;
        --badge-put: #f97316;
        --badge-delete: #ef4444;
        --badge-patch: #a855f7;
        --shadow-soft: 0 18px 55px rgba(15, 23, 42, 0.75);
        --radius-lg: 18px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
        color: var(--text-main);
        -webkit-font-smoothing: antialiased;
      }

      .app {
        display: grid;
        grid-template-columns: 260px minmax(0, 1fr);
        min-height: 100vh;
      }

      @media (max-width: 900px) {
        .app {
          grid-template-columns: minmax(0, 1fr);
        }

        .sidebar {
          position: sticky;
          top: 0;
          z-index: 10;
          border-radius: 0 0 24px 24px;
          margin: 0;
        }

        .main {
          padding-top: 12px;
        }
      }

      .sidebar {
        border-right: 1px solid rgba(148, 163, 184, 0.2);
        background: linear-gradient(160deg, #020617 0%, #020617 45%, #020617 100%);
        padding: 22px 22px 26px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 24px;
      }

      .brand-icon {
        width: 32px;
        height: 32px;
        border-radius: 13px;
        background: radial-gradient(circle at 20% 20%, #38bdf8, #0f172a 55%, #020617 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 12px 30px rgba(56, 189, 248, 0.35);
        font-weight: 800;
        letter-spacing: 0.08em;
        font-size: 11px;
        text-transform: uppercase;
      }

      .brand-text-title {
        font-weight: 650;
        letter-spacing: 0.04em;
        font-size: 14px;
        text-transform: uppercase;
      }

      .brand-text-sub {
        font-size: 12px;
        color: var(--text-soft);
      }

      .nav-section-title {
        font-size: 11px;
        text-transform: uppercase;
        color: var(--text-soft);
        letter-spacing: 0.16em;
        margin-bottom: 10px;
        margin-top: 10px;
      }

      .nav-list {
        list-style: none;
        padding: 0;
        margin: 0 0 18px;
        border-radius: 16px;
        background: radial-gradient(circle at top left, #020617 0, #020617 40%, #020617 100%);
        border: 1px solid rgba(148, 163, 184, 0.14);
      }

      .nav-item + .nav-item {
        border-top: 1px solid rgba(15, 23, 42, 0.9);
      }

      .nav-link {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 11px;
        font-size: 13px;
        color: var(--text-muted);
        text-decoration: none;
        transition: all 0.16s ease-out;
      }

      .nav-link:hover {
        background: radial-gradient(circle at top left, #020617, #020617);
        color: #f9fafb;
        transform: translateX(1px);
      }

      .nav-link span {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .nav-badge {
        font-size: 10px;
        padding: 1px 7px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        color: var(--text-soft);
      }

      .nav-kbd {
        font-size: 10px;
        padding: 1px 6px;
        border-radius: 7px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: radial-gradient(circle at top left, #020617, #020617);
        color: var(--text-soft);
      }

      .sidebar-footer {
        margin-top: auto;
        border-top: 1px solid rgba(15, 23, 42, 1);
        padding-top: 14px;
        font-size: 11px;
        color: var(--text-soft);
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .main {
        padding: 28px 30px 40px;
        max-width: 1100px;
        margin: 0 auto;
      }

      .hero {
        padding: 22px 22px 22px;
        border-radius: 22px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        background:
          radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.06), transparent 55%),
          radial-gradient(circle at 100% 0, rgba(239, 68, 68, 0.08), transparent 40%),
          linear-gradient(145deg, #020617, #020617);
        box-shadow: var(--shadow-soft);
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        gap: 16px;
      }

      .hero-main {
        max-width: 70%;
      }

      @media (max-width: 900px) {
        .main {
          padding: 20px 16px 32px;
        }
        .hero {
          flex-direction: column;
        }
        .hero-main {
          max-width: 100%;
        }
      }

      .hero-eyebrow {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--accent);
        margin-bottom: 8px;
      }

      .hero-title {
        font-size: 24px;
        font-weight: 650;
        letter-spacing: 0.03em;
        margin: 0 0 8px;
      }

      .hero-sub {
        margin: 0 0 16px;
        font-size: 13px;
        color: var(--text-muted);
      }

      .hero-chip-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .chip {
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: radial-gradient(circle at top left, #020617, #020617);
        padding: 6px 12px;
        font-size: 11px;
        color: var(--text-soft);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .chip-dot {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #22c55e, #15803d);
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.14);
      }

      .hero-meta {
        align-self: center;
        text-align: right;
        font-size: 11px;
        color: var(--text-soft);
      }

      .hero-meta pre {
        margin: 4px 0 0;
        padding: 8px 10px;
        border-radius: 10px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.18);
        font-size: 11px;
        font-family: SFMono-Regular, Menlo, Monaco, "Roboto Mono", ui-monospace,
          monospace;
        white-space: pre-wrap;
      }

      section {
        margin-bottom: 32px;
      }

      .section-heading {
        display: flex;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 10px;
      }

      .section-heading h2 {
        margin: 0;
        font-size: 16px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        font-weight: 650;
      }

      .section-heading small {
        font-size: 11px;
        color: var(--text-soft);
        text-transform: none;
      }

      .section-body {
        font-size: 13px;
        color: var(--text-muted);
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 14px;
        margin-top: 10px;
      }

      .card {
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-subtle);
        background: radial-gradient(circle at top left, #020617, #020617);
        padding: 14px 15px 13px;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 12px;
        margin-bottom: 6px;
      }

      .card-title {
        margin: 0;
        font-size: 13px;
        font-weight: 600;
      }

      .card-sub {
        margin: 0;
        font-size: 11px;
        color: var(--text-soft);
      }

      .badge {
        border-radius: 999px;
        padding: 2px 9px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.09em;
        border: 1px solid transparent;
      }

      .badge-get {
        border-color: rgba(34, 197, 94, 0.5);
        color: var(--badge-get);
        background: radial-gradient(circle at top left, rgba(22, 163, 74, 0.2), transparent);
      }

      .badge-post {
        border-color: rgba(14, 165, 233, 0.5);
        color: var(--badge-post);
        background: radial-gradient(
          circle at top left,
          rgba(56, 189, 248, 0.2),
          transparent
        );
      }

      .badge-put {
        border-color: rgba(249, 115, 22, 0.5);
        color: var(--badge-put);
        background: radial-gradient(circle at top left, rgba(249, 115, 22, 0.2), transparent);
      }

      .badge-delete {
        border-color: rgba(239, 68, 68, 0.5);
        color: var(--badge-delete);
        background: radial-gradient(circle at top left, rgba(239, 68, 68, 0.2), transparent);
      }

      .endpoint-path {
        font-family: SFMono-Regular, Menlo, Monaco, "Roboto Mono", ui-monospace,
          monospace;
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.2);
        color: #e5e7eb;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 6px;
      }

      .endpoint-desc {
        font-size: 12px;
        color: var(--text-muted);
        margin-bottom: 8px;
      }

      .pill-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 6px;
      }

      .pill {
        font-size: 11px;
        border-radius: 999px;
        padding: 2px 7px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        color: var(--text-soft);
      }

      .pill-req {
        border-color: rgba(248, 113, 113, 0.65);
        color: #fecaca;
      }

      .pill-auth {
        border-color: rgba(96, 165, 250, 0.7);
        color: #bfdbfe;
      }

      .pill-safe {
        border-color: rgba(52, 211, 153, 0.6);
        color: #a7f3d0;
      }

      .subtitle {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--text-soft);
        margin: 10px 0 4px;
      }

      .schema-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 14px;
      }

      pre {
        margin: 6px 0 0;
        padding: 10px 11px;
        border-radius: 13px;
        background: var(--code-bg);
        border: 1px solid rgba(148, 163, 184, 0.25);
        font-size: 11px;
        font-family: SFMono-Regular, Menlo, Monaco, "Roboto Mono", ui-monospace,
          monospace;
        color: #e5e7eb;
        overflow-x: auto;
        max-height: 260px;
      }

      .small {
        font-size: 11px;
      }

      .muted {
        color: var(--text-soft);
      }

      .tag-output {
        font-size: 10px;
        padding: 1px 7px;
        border-radius: 999px;
        border: 1px dashed rgba(148, 163, 184, 0.4);
        color: var(--text-soft);
      }

      .anchor {
        position: relative;
        top: -72px;
        visibility: hidden;
      }

      .status-list {
        list-style: none;
        padding-left: 0;
        margin: 4px 0 0;
      }

      .status-item {
        margin-bottom: 4px;
      }

      .status-code {
        font-weight: 600;
        font-size: 11px;
        padding: 1px 6px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        margin-right: 6px;
      }

      .status-code.ok {
        border-color: rgba(34, 197, 94, 0.7);
        color: #bbf7d0;
      }

      .status-code.err {
        border-color: rgba(239, 68, 68, 0.7);
        color: #fecaca;
      }

      .status-code.info {
        border-color: rgba(56, 189, 248, 0.7);
        color: #bae6fd;
      }

      .status-body {
        display: block;
        margin-left: 4px;
        font-size: 11px;
        color: var(--text-soft);
      }

      code {
        font-family: SFMono-Regular, Menlo, Monaco, "Roboto Mono", ui-monospace,
          monospace;
        font-size: 11px;
      }

      .badge-shared {
        font-size: 10px;
        padding: 1px 6px;
        border-radius: 999px;
        border: 1px dashed rgba(148, 163, 184, 0.4);
        color: var(--text-soft);
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-icon">KP</div>
          <div>
            <div class="brand-text-title">KingPin API</div>
            <div class="brand-text-sub">Full Route Reference</div>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <ul class="nav-list">
            <li class="nav-item">
              <a href="#intro" class="nav-link">
                <span>Introduction</span>
                <span class="nav-badge">v1</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#shared-errors" class="nav-link">
                <span>Shared Errors</span>
                <span class="nav-kbd">Auth</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#schemas" class="nav-link">
                <span>Schemas</span>
                <span class="nav-kbd">JSON</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Resources</div>
          <ul class="nav-list">
            <li class="nav-item">
              <a href="#auth-accounts" class="nav-link">
                <span>Auth &amp; Accounts</span>
                <span class="nav-badge">8 routes</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#teams" class="nav-link">
                <span>Teams</span>
                <span class="nav-badge">5 routes</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#players" class="nav-link">
                <span>Players</span>
                <span class="nav-badge">5 routes</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#matches" class="nav-link">
                <span>Matches</span>
                <span class="nav-badge">5 routes</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#per-player" class="nav-link">
                <span>Per-player Stats</span>
                <span class="nav-badge">2 routes</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#password-reset" class="nav-link">
                <span>Password Reset</span>
                <span class="nav-badge">3 routes</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="#misc" class="nav-link">
                <span>Misc</span>
                <span class="nav-badge">3 routes</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="sidebar-footer">
          <span>Base URL (local)</span>
          <code class="small">http://localhost:3000</code>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <main class="main">
        <!-- HERO / INTRO -->
        <div id="intro" class="anchor"></div>
        <section class="hero">
          <div class="hero-main">
            <div class="hero-eyebrow">KingPin backend</div>
            <h1 class="hero-title">KingPin Backend</h1>
            <p class="hero-sub">
              Hello! This is the KingPin Backend. While the backend is written by Abhirv Jatar, this entire file was completely generated with GPT5.1 and therefore SHOULD be accurate, but there are no guarantees. If something doesn't match up, please contact me because this doc may have gone out of support.
            </p>
            <div class="hero-chip-row">
              <div class="chip">
                <span class="chip-dot"></span>
                Last Updated Dec 11, 2025
              </div>
              <div class="chip">Auth: password in JSON body</div>
              <div class="chip">Storage: MongoDB via <code>db.loadAll/saveAll</code></div>
              <div class="chip">CORS: <code>*</code> allowed</div>
            </div>
          </div>
          <div class="hero-meta">
            <div>Quick start</div>
            <pre><code>npm install
node server.js

GET / → "Hello World!"</code></pre>
          </div>
        </section>

        <!-- SHARED ERRORS -->
        <div id="shared-errors" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Shared error formats</h2>
            <small>These appear on multiple routes</small>
          </div>
          <div class="section-body">
            <p class="small muted">
              Many routes reuse the same validation / ownership helpers. To avoid repetition,
              these shared errors are referenced in each route card with
              <span class="badge-shared">Shared auth/ownership errors</span>.
            </p>

            <div class="card-grid">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Auth: <code>requireValidPassword</code></h3>
                  <span class="badge badge-post">Middleware</span>
                </div>
                <p class="endpoint-desc">
                  Used on routes that require the user's current password in the JSON body.
                  Reads <code>req.params.userId</code>.
                </p>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <strong>Missing password</strong><br />
                      JSON body omits both <code>password</code> and
                      <code>currentPassword</code>:
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <strong>Invalid password</strong><br />
                      Hash check fails or user not found:
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    Ownership: <code>ensureUserAndTeam</code>
                  </h3>
                  <span class="badge badge-get">Helper</span>
                </div>
                <p class="endpoint-desc">
                  Used on team / player / match routes to validate that the given
                  <code>userId</code> exists and owns the specified <code>teamId</code>.
                </p>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <strong>User not found</strong><br />
                      <code>{"error":"user not found"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <strong>Team not found</strong><br />
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <strong>Team does not belong to user</strong><br />
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">CORS &amp; JSON</h3>
                  <span class="badge badge-get">Global</span>
                </div>
                <p class="endpoint-desc">
                  All routes use <code>express.json()</code> and global CORS middleware:
                </p>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code info">OPTIONS 204</span>
                    <span class="status-body">
                      Preflight requests are answered with no body and headers:<br />
                      <code>Access-Control-Allow-Origin: *</code><br />
                      <code>Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS, PATCH</code
                      ><br />
                      <code>Access-Control-Allow-Headers: Content-Type, Authorization</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- SCHEMAS -->
        <div id="schemas" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Schemas</h2>
            <small>Current in-memory shapes (will change)</small>
          </div>
          <div class="section-body">
            <p>
              Internal schemas used in the implementation. Public responses omit sensitive
              fields via <code>publicUser</code>, <code>publicTeam</code>,
              <code>publicPlayer</code>, and <code>publicMatch</code>.
            </p>

            <div class="subtitle">UserSchema</div>
            <div class="schema-grid">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Internal</h3>
                  <span class="tag-output">Stored as <code>users[userId]</code></span>
                </div>
                <pre><code>{
  userId: string,
  email: string,
  password: string,           // bcrypt hash
  username: string,
  displayName: string,
  teamIds: { [teamId: string]: true },
  resetToken: string | null,
  resetTokenExpiry: number | null
}</code></pre>
              </div>
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Public (API)</h3>
                  <span class="tag-output"><code>publicUser(user)</code></span>
                </div>
                <pre><code>{
  userId: string,
  email: string,
  username: string,
  displayName: string,
  teamIds: { [teamId: string]: true },
  resetToken?: undefined,
  resetTokenExpiry?: undefined,
  password?: undefined
}</code></pre>
              </div>
            </div>

            <div class="subtitle">TeamSchema</div>
            <div class="schema-grid">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Team</h3>
                  <span class="tag-output">Stored as <code>teams[teamId]</code></span>
                </div>
                <pre><code>{
  teamId: string,
  ownerId: string,  // userId
  displayName: string,
  playerIds: { [playerId: string]: true },
  awardsList: string[],
  matchIds: { [matchId: string]: true }
}</code></pre>
              </div>
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Player</h3>
                  <span class="tag-output">Stored as <code>players[playerId]</code></span>
                </div>
                <pre><code>{
  playerId: string,
  displayName: string,
  teamId: string,
  matchIds: { [matchId: string]: true },
  graduationYear: number | null
}</code></pre>
              </div>
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Match</h3>
                  <span class="tag-output">Stored as <code>matches[matchId]</code></span>
                </div>
                <pre><code>{
  matchId: string,
  teamId: string,
  date: number,                 // Unix timestamp (ms)
  opposingTeamName: string,
  comment: string,
  perPlayerData: {
    [playerId: string]: {
      games: {
        1: { Wood: number, Score: number, isVarsity: boolean },
        2: { Wood: number, Score: number, isVarsity: boolean },
        3: { Wood: number, Score: number, isVarsity: boolean }
      }
    }
  }
}</code></pre>
              </div>
            </div>
          </div>
        </section>

        <!-- AUTH & ACCOUNTS -->
        <div id="auth-accounts" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Auth &amp; Accounts</h2>
            <small>Account creation, login, profile &amp; deletion</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- POST /accounts -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Create account</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/accounts</span>
                </div>
                <p class="endpoint-desc">
                  Registers a new user, hashes password and sends a welcome email.
                </p>
                <div class="pill-row">
                  <span class="pill pill-req">Body: email (string, valid)</span>
                  <span class="pill pill-req">Body: password (string, ≥ 8)</span>
                  <span class="pill pill-req">Body: username (string)</span>
                  <span class="pill">Body: displayName (string, optional)</span>
                </div>
                <pre><code>Request body
{
  "email": "user@example.com",
  "password": "super-secure-password",
  "username": "nathan",
  "displayName": "Nathan"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">201</span>
                    <span class="status-body">
                      <strong>Account created</strong><br />
                      <code>{"user": { ...publicUser }}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing required fields:
                      <code>{"error":"email, password and username are required"}</code><br />
                      Invalid email:
                      <code>{"error":"invalid email format"}</code><br />
                      Short password:
                      <code>{"error":"password must be at least 8 characters"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">409</span>
                    <span class="status-body">
                      Pending concurrent signup:
                      <code>{"error":"email or username already in use"}</code><br />
                      Email already exists:
                      <code>{"error":"email already in use"}</code><br />
                      Username already exists:
                      <code>{"error":"username already in use"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      Internal DB/save error:
                      <code>{"error":"Internal server error"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- POST /auth/login -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Login</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/auth/login</span>
                </div>
                <p class="endpoint-desc">
                  Verifies email + password. No sessions/tokens are created; used mainly for
                  UI login.
                </p>
                <div class="pill-row">
                  <span class="pill pill-req">Body: email (string)</span>
                  <span class="pill pill-req">Body: password (string)</span>
                </div>
                <pre><code>Request body
{
  "email": "user@example.com",
  "password": "super-secure-password"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      Valid credentials:
                      <code>{"ok":true,"user":{...publicUser}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing email or password:
                      <code>{"ok":false,"error":"email and password required"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      User not found or password mismatch:
                      <code>{"ok":false,"error":"invalid credentials"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      bcrypt or internal error:
                      <code>{"ok":false,"error":"internal error"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- POST /accounts/:userId/password -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Change password</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/accounts/:userId/password</span>
                </div>
                <p class="endpoint-desc">
                  Changes password after validating current password.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">Shared: requireValidPassword</span>
                  <span class="pill pill-req">Body: currentPassword</span>
                  <span class="pill pill-req">Body: newPassword (≥ 8)</span>
                </div>
                <pre><code>Request body
{
  "currentPassword": "old-pass",
  "newPassword": "new-super-secure"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"success":true}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing <code>password/currentPassword</code> (middleware):<br />
                      <code>{"error":"password is required in request body"}</code><br />
                      Missing <code>newPassword</code>:
                      <code>{"error":"newPassword is required"}</code><br />
                      Short <code>newPassword</code>:
                      <code>{"error":"newPassword must be at least 8 characters"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      Incorrect current password:
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- POST /accounts/:userId/displayName -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Change display name</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/accounts/:userId/displayName</span>
                </div>
                <p class="endpoint-desc">
                  Updates <code>user.displayName</code>.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">Shared: requireValidPassword</span>
                  <span class="pill pill-req">Body: password</span>
                  <span class="pill pill-req">Body: displayName</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "displayName": "New Name"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"user":{...publicUser}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      From middleware:
                      <code>{"error":"password is required in request body"}</code><br />
                      Missing displayName:
                      <code>{"error":"displayName is required"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      Invalid password:
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- DELETE /accounts/:userId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Delete account</h3>
                  <span class="badge badge-delete">DELETE</span>
                </div>
                <div class="endpoint-path">
                  <span>/accounts/:userId</span>
                </div>
                <p class="endpoint-desc">
                  Deletes user and cascades deletion to all their teams, players and matches.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">Shared: requireValidPassword</span>
                  <span class="pill pill-req">Body: password</span>
                  <span class="pill pill-safe">Cascade: deleteTeamCascade()</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"success":true}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      From middleware:
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      Invalid password:
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Very edge case (user missing after auth):
                      <code>{"error":"user not found"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      DB save error:
                      <code>{"error":"Internal server error"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /accounts/:userId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Get account</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/accounts/:userId</span>
                </div>
                <p class="endpoint-desc">
                  Public view of a user (no password / reset fields).
                </p>
                <div class="pill-row">
                  <span class="pill">No auth</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"user":{...publicUser}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /emailDeleteAccount/:userId/:password -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Delete via email link</h3>
                  <span class="badge badge-get">GET (HTML)</span>
                </div>
                <div class="endpoint-path">
                  <span>/emailDeleteAccount/:userId/:password</span>
                </div>
                <p class="endpoint-desc">
                  One-click account deletion from an emailed link, using userId and plain
                  password in the URL.
                </p>
                <div class="pill-row">
                  <span class="pill">Response: HTML page</span>
                  <span class="pill pill-safe">Cascade delete</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      Account deleted; HTML "Account Deleted" confirmation page.
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      User not found; HTML "User not found" page.
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      Password check fails; HTML "Invalid or expired link" page.
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      Error during cascade delete; HTML "Error" page.
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- TEAMS -->
        <div id="teams" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Teams</h2>
            <small>Owned by a specific user</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- POST /users/:userId/teams -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Create team</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams</span>
                </div>
                <p class="endpoint-desc">
                  Creates a new team for the given user.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">Shared: requireValidPassword</span>
                  <span class="pill pill-req">Body: password</span>
                  <span class="pill">Body: displayName (optional)</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "displayName": "Varsity A"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">201</span>
                    <span class="status-body">
                      <code>{"team":{...team}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      From auth middleware:
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      Invalid password:
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      User not found:
                      <code>{"error":"user not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">List teams</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams</span>
                </div>
                <p class="endpoint-desc">
                  Lists all teams owned by this user.
                </p>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"teams":[{...team}, ...]}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams/:teamId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Get team</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId</span>
                </div>
                <p class="endpoint-desc">
                  Gets a single team if the user owns it.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">Shared: ensureUserAndTeam</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"team":{...team}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      Team doesn't belong to user:
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      User:
                      <code>{"error":"user not found"}</code><br />
                      or team:
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- PUT /users/:userId/teams/:teamId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Update team</h3>
                  <span class="badge badge-put">PUT</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId</span>
                </div>
                <p class="endpoint-desc">
                  Updates team <code>displayName</code>.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill">Body: displayName</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "displayName": "New Team Name"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"team":{...team}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      From middleware:
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      Invalid password:
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      User or team missing:<br />
                      <code>{"error":"user not found"}</code> or
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- DELETE /users/:userId/teams/:teamId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Delete team</h3>
                  <span class="badge badge-delete">DELETE</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId</span>
                </div>
                <p class="endpoint-desc">
                  Deletes team and cascades to players and matches.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill pill-safe">deleteTeamCascade()</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"success":true}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code> or
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- PLAYERS -->
        <div id="players" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Players</h2>
            <small>Roster per team</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- POST /users/:userId/teams/:teamId/players -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Create player</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/players</span>
                </div>
                <p class="endpoint-desc">
                  Adds a new player to a team.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill pill-req">Body: password</span>
                  <span class="pill">Body: displayName</span>
                  <span class="pill">Body: graduationYear (1900–2100)</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "displayName": "Player Name",
  "graduationYear": 2027
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">201</span>
                    <span class="status-body">
                      <code>{"player":{...player}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      From middleware:
                      <code>{"error":"password is required in request body"}</code><br />
                      Invalid graduation year:
                      <code>{"error":"graduationYear must be a valid year"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code> or
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams/:teamId/players -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">List players</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/players</span>
                </div>
                <p class="endpoint-desc">
                  Lists all players in the team.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"players":[{...player}, ...]}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code> or
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams/:teamId/players/:playerId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Get player</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/players/:playerId</span>
                </div>
                <p class="endpoint-desc">
                  Fetches a single player by id within a team.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"player":{...player}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Ownership errors:
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"forbidden: team does not belong to user"}</code><br />
                      Player not in team:
                      <code>{"error":"player not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- PUT /users/:userId/teams/:teamId/players/:playerId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Update player</h3>
                  <span class="badge badge-put">PUT</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/players/:playerId</span>
                </div>
                <p class="endpoint-desc">
                  Updates player name and/or graduation year.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill">Body: displayName</span>
                  <span class="pill">Body: graduationYear</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "displayName": "New Player Name",
  "graduationYear": 2026
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"player":{...player}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing password:
                      <code>{"error":"password is required in request body"}</code><br />
                      Invalid graduation year:
                      <code>{"error":"graduationYear must be a valid year"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      User / team:
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code><br />
                      Player not in team:
                      <code>{"error":"player not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- DELETE /users/:userId/teams/:teamId/players/:playerId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Delete player</h3>
                  <span class="badge badge-delete">DELETE</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/players/:playerId</span>
                </div>
                <p class="endpoint-desc">
                  Removes a player and their entries from all team matches'
                  <code>perPlayerData</code>.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill pill-safe">Cleans perPlayerData</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"success":true}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Ownership errors or missing player:<br />
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"player not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- MATCHES -->
        <div id="matches" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Matches</h2>
            <small>Per-team match records</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- POST /users/:userId/teams/:teamId/matches -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Create match</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/matches</span>
                </div>
                <p class="endpoint-desc">
                  Creates a new match and initializes per-player game slots (1–3).
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill">Body: date (number, optional)</span>
                  <span class="pill">Body: opposingTeamName (string)</span>
                  <span class="pill">Body: comment (string, optional)</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "date": 1736291763000,
  "opposingTeamName": "Rival High",
  "comment": "Season opener"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">201</span>
                    <span class="status-body">
                      <code>{"match":{...match}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing password:
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code> or
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams/:teamId/matches -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">List matches</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/matches</span>
                </div>
                <p class="endpoint-desc">
                  Lists all matches belonging to a team.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"matches":[{...match}, ...]}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code> or
                      <code>{"error":"team not found"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams/:teamId/matches/:matchId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Get match</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/matches/:matchId</span>
                </div>
                <p class="endpoint-desc">
                  Fetches a single match within a team.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"match":{...match}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Ownership errors:
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"forbidden: team does not belong to user"}</code><br />
                      Match not in team:
                      <code>{"error":"match not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- PUT /users/:userId/teams/:teamId/matches/:matchId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Update match</h3>
                  <span class="badge badge-put">PUT</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/matches/:matchId</span>
                </div>
                <p class="endpoint-desc">
                  Updates <code>date</code>, <code>opposingTeamName</code> and
                  <code>comment</code>.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill">Body: date (optional)</span>
                  <span class="pill">Body: opposingTeamName (optional)</span>
                  <span class="pill">Body: comment (optional)</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "date": 1736291763000,
  "opposingTeamName": "Rival High 2",
  "comment": "Rescheduled"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"match":{...match}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Ownership errors or missing match:<br />
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"match not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- DELETE /users/:userId/teams/:teamId/matches/:matchId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Delete match</h3>
                  <span class="badge badge-delete">DELETE</span>
                </div>
                <div class="endpoint-path">
                  <span>/users/:userId/teams/:teamId/matches/:matchId</span>
                </div>
                <p class="endpoint-desc">
                  Deletes a match and removes it from
                  <code>team.matchIds</code>.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"success":true}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <code>{"error":"password is required in request body"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"match not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- PER-PLAYER MATCH DATA -->
        <div id="per-player" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Per-player match data</h2>
            <small>Game-level stats</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- PUT /users/:userId/teams/:teamId/matches/:matchId/players/:playerId/games/:gameIndex -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Update a single game</h3>
                  <span class="badge badge-put">PUT</span>
                </div>
                <div class="endpoint-path">
                  <span
                    >/users/:userId/teams/:teamId/matches/:matchId/players/:playerId/games/:gameIndex</span
                  >
                </div>
                <p class="endpoint-desc">
                  Updates game stats for a specific player in a specific match, game indices
                  1–3.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">requireValidPassword</span>
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                  <span class="pill pill-req">Path: gameIndex ∈ {1,2,3}</span>
                  <span class="pill">Body: Wood (number)</span>
                  <span class="pill">Body: Score (number)</span>
                  <span class="pill">Body: isVarsity (boolean)</span>
                </div>
                <pre><code>Request body
{
  "password": "current-pass",
  "Wood": 10,
  "Score": 178,
  "isVarsity": true
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"playerGame":{"Wood":10,"Score":178,"isVarsity":true}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing password:
                      <code>{"error":"password is required in request body"}</code><br />
                      Invalid <code>gameIndex</code>:
                      <code>{"error":"gameIndex must be 1, 2 or 3"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">401</span>
                    <span class="status-body">
                      <code>{"error":"invalid password"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">403</span>
                    <span class="status-body">
                      <code>{"error":"forbidden: team does not belong to user"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Missing user/team/match/player:<br />
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"match not found in team"}</code>,
                      <code>{"error":"player not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /users/:userId/teams/:teamId/matches/:matchId/players/:playerId -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Get per-player data</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span
                    >/users/:userId/teams/:teamId/matches/:matchId/players/:playerId</span
                  >
                </div>
                <p class="endpoint-desc">
                  Returns the <code>perPlayerData</code> object for a player in a match.
                  Missing games are filled with default zero values.
                </p>
                <div class="pill-row">
                  <span class="pill pill-auth">ensureUserAndTeam</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"perPlayerData":{"games":{"1":{...},"2":{...},"3":{...}}}}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Ownership or match errors:<br />
                      <code>{"error":"user not found"}</code>,
                      <code>{"error":"team not found"}</code>,
                      <code>{"error":"forbidden: team does not belong to user"}</code>,
                      <code>{"error":"match not found in team"}</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- PASSWORD RESET -->
        <div id="password-reset" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Password reset flow</h2>
            <small>Token-based via email</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- POST /requestPassword -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Request reset link</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/requestPassword</span>
                </div>
                <p class="endpoint-desc">
                  Generates a reset token and sends an email. Response does not reveal whether
                  an account exists.
                </p>
                <div class="pill-row">
                  <span class="pill pill-req">Body: email</span>
                  <span class="pill pill-safe">No account enumeration</span>
                </div>
                <pre><code>Request body
{
  "email": "user@example.com"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      Whether or not the email exists:<br />
                      <code>{"success":true,"message":"If an account with that email exists, a reset link has been sent."}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <code>{"error":"email is required"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      <code>{"error":"Internal server error"}</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- GET /resetPassword/:token -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Show reset form (HTML)</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/resetPassword/:token</span>
                </div>
                <p class="endpoint-desc">
                  Renders an HTML form for entering a new password if token is valid and not
                  expired.
                </p>
                <div class="pill-row">
                  <span class="pill">Response: HTML</span>
                  <span class="pill">Token expiry: 1 hour</span>
                </div>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      HTML page with password + confirmation fields and script that POSTs to
                      this same URL.
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Token invalid/expired: HTML "Invalid or Expired Link" page.
                    </span>
                  </li>
                </ul>
              </div>

              <!-- POST /resetPassword/:token -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Submit new password</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/resetPassword/:token</span>
                </div>
                <p class="endpoint-desc">
                  Resets password if token is still valid, then clears token &amp; expiry.
                </p>
                <div class="pill-row">
                  <span class="pill pill-req">Body: password (≥ 8)</span>
                </div>
                <pre><code>Request body
{
  "password": "new-super-secure"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{"success":true,"message":"Password has been reset successfully"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      Missing password:
                      <code>{"error":"password is required"}</code><br />
                      Short password:
                      <code>{"error":"password must be at least 8 characters"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">404</span>
                    <span class="status-body">
                      Invalid/expired token:
                      <code>{"error":"Invalid or expired reset link"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      <code>{"error":"Internal server error"}</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- MISC -->
        <div id="misc" class="anchor"></div>
        <section>
          <div class="section-heading">
            <h2>Miscellaneous</h2>
            <small>Healthcheck &amp; test email</small>
          </div>
          <div class="section-body">
            <div class="card-grid">
              <!-- GET / -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Health / root</h3>
                  <span class="badge badge-get">GET</span>
                </div>
                <div class="endpoint-path">
                  <span>/</span>
                </div>
                <p class="endpoint-desc">
                  Simple root endpoint for sanity checks.
                </p>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      Body (text):
                      <code>Hello World!</code>
                    </span>
                  </li>
                </ul>
              </div>

              <!-- POST /test/send-email -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Test: send welcome email</h3>
                  <span class="badge badge-post">POST</span>
                </div>
                <div class="endpoint-path">
                  <span>/test/send-email</span>
                </div>
                <p class="endpoint-desc">
                  Diagnostics-only endpoint to trigger <code>sendWelcomeEmail</code> with a
                  temporary user id and password.
                </p>
                <div class="pill-row">
                  <span class="pill pill-req">Body: email</span>
                </div>
                <pre><code>Request body
{
  "email": "someone@example.com"
}</code></pre>
                <ul class="status-list">
                  <li class="status-item">
                    <span class="status-code ok">200</span>
                    <span class="status-body">
                      <code>{
  "success": true,
  "message": "Email sent to someone@example.com",
  "messageId": "..." // if available
}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">400</span>
                    <span class="status-body">
                      <code>{"error":"email is required"}</code>
                    </span>
                  </li>
                  <li class="status-item">
                    <span class="status-code err">500</span>
                    <span class="status-body">
                      <code>{"success":false,"error":"&lt;mailer error message&gt;"}</code>
                    </span>
                  </li>
                </ul>
              </div>
            </div>

            <p class="small muted" style="margin-top: 18px;">
              All JSON endpoints expect <code>Content-Type: application/json</code> and return
              JSON bodies as shown above. Errors are not localized and are suitable for debug
              displays or mapping to UI messages.
            </p>
          </div>
        </section>
      </main>
    </div>
  </body>
</html>
